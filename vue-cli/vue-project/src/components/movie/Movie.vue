<template>
  <div class='movie'>
    <common-header title="movie" bgColor="rgb(33, 150, 243)">
      <button>首页</button>
    </common-header>
  
    <movie-nav></movie-nav>
    <router-view></router-view>
          <div class="loading" v-show="isShow">
            <img src="/static/img/loading.gif" alt="">
          </div>
    
    <common-footer bgColor="rgb(33,150,243)"></common-footer>

  </div>
  
</template>

<script>
  import CommonHeader from "../common/CommonHeader"
  import CommonFooter from "../common/CommonFooter"
  import MovieNav from "./MovieNav"
  import MovieList from "./MovieList"
  import Axios from 'axios'
      export default {
        data () {
          return {
            movieList:[],
            isShow:false
          }
        },
  mounted(){
      Axios.get(API_PROXY +  "http://m.maoyan.com/movie/list.json?type=hot&offset=0&limit=10")
     .then((res)=>{
        this.movieList = res.data.data.movies;
      });
        let _this = this;
        window.onscroll = function(){
        
        let clientHeight = document.documentElement.clientHeight;
        let scrollTop = document.documentElement.scrollTop;
        let scrollHeight = document.documentElement.scrollHeight;

        if(clientHeight + scrollTop >=scrollHeight){
          _this.isShow = true;
          Axios.get(API_PROXY + "http://m.maoyan.com/movie/list.json?type=hot&offset="+_this.movieList.length+"&limit=10")
          .then((res)=>{
           _this.movieList = _this.movieList.concat(res.data.data.movies);
           _this.isShow = false;
          });
        }
       }

      },
  
   components:{
            CommonHeader,
            CommonFooter,
            MovieNav,
            MovieList
        }
    }
</script>

<!-- Add "scoped" attribute to limit CSS to this component only -->
<style>
   .list-box{
     margin:2rem 0 1.6rem;
    
   }
   button{
     background: rgb(33, 150, 243);
   }
   .loading{
     margin-bottom:1rem;
     text-align: center;
   }
</style>
